


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xml:lang="" lang="" version="-//W3C//DTD XHTML 1.1//EN" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Running Jobs on Katana &mdash; Katana User 0.9 documentation</title>
  

  

  

    <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'/>
    <link rel="stylesheet" href="../_static/css/pdj.css" type="text/css" />

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Katana User 0.9 documentation" href="../index.html"/>
        <link rel="up" title="Using Katana" href="index.html"/>
        <link rel="next" title="GitHub" href="github.html"/>
        <link rel="prev" title="Accessing Katana" href="accessing_katana.html"/>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="cache-control" content="public" />
    <meta name="robots" content="follow, all" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Add jQuery library -->
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

  </head>

  <body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> Katana User </a>
        <div role="search">
	  <form id ="rtd-search-form" class="wy-form"
		action="../search.html" method="get">
	    <input type="text" name="q" placeholder="Search docs" />
	    <input type="hidden" name="check_keywords" value="yes" />
	    <input type="hidden" name="area" value="default" />
	  </form>
	</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	
          
          
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../help_and_support.html">Help and Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../help_and_support.html#scheduled-maintenance">Scheduled Maintenance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help_and_support.html#contact-the-research-technology-services-team">Contact the Research Technology Services team</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help_and_support.html#katana-system-status-and-known-issues">Katana System Status and Known Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../help_and_support.html#katana-terms-of-use">Katana Terms of Use</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Using Katana</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="about_katana.html">About Katana</a></li>
<li class="toctree-l2"><a class="reference internal" href="accessing_katana.html">Accessing Katana</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Running Jobs on Katana</a></li>
<li class="toctree-l2"><a class="reference internal" href="github.html">GitHub</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../storage/index.html">Storage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../storage/storage_locations.html">Storage Locations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/kdm.html">Katana Data Mover</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/data_archive.html">How to use the UNSW Data Archive</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../software/index.html">Software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../software/environment_modules.html">Environment Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/biosciences.html">Biosciences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/java.html">Java</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/intel_compilers_and_libraries.html">Intel Compilers and Software Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/operating_systems.html">Operating Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/perl.html">Perl</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/python.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/python-virtualenvs.html">Python Virtual Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/python-virtualenvs-internals.html">Virtual Environments from the inside</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/python-jupyter-notebooks.html">Jupyter Notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/r.html">R and RStudio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/sas.html">SAS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/stata.html">Stata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/tmux.html">TMUX</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference_data.html">Reference Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#general-faq">General FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#scheduler-faq">Scheduler FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#storage-faq">Storage FAQ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#expanding-katana">Expanding Katana</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#acknowledging-katana">Acknowledging Katana</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

          
        

      </div>
      &nbsp;
    </nav>
    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      <nav class="wy-nav-top" id="barra-mobile" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="#">Porão do Juca</a>
      </nav>

      <div class="wy-nav-content">
	<div class="fundo-claro">
	</div>
	<div class="fundo-escuro">
	</div>

        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
	    
	    <!-- <ul class="wy-breadcrumbs"> -->
	    <!--   <li><a href="#">Docs</a> &raquo;</li> -->

	    <!--   <li>Features</li> -->
	    <!--   <li class="wy-breadcrumbs-aside"> -->

	    <!-- 	<a href="_sources/index.txt" rel="nofollow"> View page source</a> -->

	    <!--   </li> -->
	    <!-- </ul> -->
	    <!-- <hr/> -->
	  </div>

          <div role="main" class="">

	    <div id="content" class="hfeed entry-container hentry">
  <div class="section" id="running-jobs-on-katana">
<span id="running-jobs"></span><h1>Running Jobs on Katana<a class="headerlink" href="#running-jobs-on-katana" title="Permalink to this headline">¶</a></h1>
<div class="section" id="brief-overview">
<h2>Brief Overview<a class="headerlink" href="#brief-overview" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../glossary.html#term-Login-Node"><span class="xref std std-term">Login Node</span></a> of a cluster is a shared resource for all users and is used for preparing, submitting and managing jobs. Never run any computationally intensive processes on the login nodes. Jobs are submitted from the login node, which delivers them to the <a class="reference internal" href="../glossary.html#term-Head-Node"><span class="xref std std-term">Head Node</span></a> for job and resource management. Once the resources have been allocated and are available, the job will run on one or more of the compute nodes as requested.</p>
<p>Different clusters use different tools to manage resources and schedule jobs - <a class="reference external" href="https://www.pbspro.org/">OpenPBS</a> and <a class="reference external" href="https://slurm.schedmd.com/">SLURM</a> are two popular systems. Katana, like NCI’s Gadi, uses <a class="reference external" href="https://www.pbspro.org/">OpenPBS</a> for this purpose.</p>
<p>Jobs are submitted using the <code class="code docutils literal notranslate"><span class="pre">qsub</span></code> command. There are two types of job that <code class="code docutils literal notranslate"><span class="pre">qsub</span></code> will accept: an <a class="reference internal" href="../glossary.html#term-Interactive-Job"><span class="xref std std-term">Interactive Job</span></a> and a <a class="reference internal" href="../glossary.html#term-Batch-Job"><span class="xref std std-term">Batch Job</span></a>. Regardless of type, the resource manager will put your job in a <a class="reference internal" href="../glossary.html#term-Queue"><span class="xref std std-term">Queue</span></a>.</p>
<p>An <strong>interactive job</strong> provides a shell session on a <a class="reference internal" href="../glossary.html#term-Compute-Nodes"><span class="xref std std-term">Compute Nodes</span></a>. You interact directly with the compute node running the software you need explicitly. Interactive jobs are useful for experimentation, debugging, and planning for <strong>batch jobs</strong>.</p>
<p>In contrast, a <a class="reference internal" href="../glossary.html#term-Batch-Job"><span class="xref std std-term">Batch Job</span></a> is a scripted job that - after submission via <code class="code docutils literal notranslate"><span class="pre">qsub</span></code> - runs from start to finish without any user intervention. The vast majority of jobs on the cluster are batch jobs. This type of job is appropriate for production runs that will consume several hours or days.</p>
<p>To submit a <a class="reference internal" href="../glossary.html#term-Batch-Job"><span class="xref std std-term">Batch Job</span></a> you will need to create a job script which specifies the resources that your job requires and calls your program. The general structure of <a class="reference internal" href="#a-job-script">A Job Script</a> is shown below.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>All jobs go into a <a class="reference internal" href="../glossary.html#term-Queue"><span class="xref std std-term">Queue</span></a> while waiting for resources to become available. The length of time your jobs wait in a queue for resources depends on a number of factors.</p>
</div>
<p>The main resources available for use are Memory (RAM), <a class="reference internal" href="../glossary.html#term-CPU-Core"><span class="xref std std-term">CPU Core</span></a> (number of CPUs) and <a class="reference internal" href="../glossary.html#term-Walltime"><span class="xref std std-term">Walltime</span></a> (how long you want the CPUs for). These need to be considered carefully when writing your job script, since the decisions you make will impact which queue your jobs ends up on.</p>
<p>As you request more memory, the number of available queues goes down. The memory limits, in GB, at which the number of queues decreases are 124, 180, 248, 370, 750 and 1000.</p>
<p>Similarly, when considering the number of CPU cores, the available resources reduce at 16, 20, 24, 28, 32, 44 and 64 CPU cores.</p>
<p>Walltime provides the biggest constraint on your submitted jobs. The points at which resource availability is reduced are 12, 48, 100 and 200 hours</p>
<p>Jobs have the following restrictions:</p>
<ul class="simple">
<li><p>Jobs of up to 12 hours can run anywhere on the cluster</p></li>
<li><p>Jobs of up to 100 hours can run on nodes belonging to your group and the general nodes</p></li>
<li><p>Jobs of up to 200 hours can only run on nodes belonging to your group</p></li>
</ul>
</div>
<div class="section" id="interactive-jobs">
<span id="interactive-session"></span><span id="interactive-job"></span><h2>Interactive Jobs<a class="headerlink" href="#interactive-jobs" title="Permalink to this headline">¶</a></h2>
<p>An interactive job or interactive session is a session on a compute node with the required physical resources for the period of time requested. To request an interactive job, add the -I flag (capital i) to <code class="code docutils literal notranslate"><span class="pre">qsub</span></code>. Default sessions will have 1 CPU core, 1GB and 1 hour</p>
<p>For example, the following two commands. The first provides a default session, the second provides a session with two CPU core and 8GB memory for three hours. You can tell when an interactive job has started when you see the name of the server change from <code class="code docutils literal notranslate"><span class="pre">katana1</span></code> or <code class="code docutils literal notranslate"><span class="pre">katana2</span></code> to the name of the server your job is running on. In these cases it’s <code class="code docutils literal notranslate"><span class="pre">k181</span></code> and <code class="code docutils literal notranslate"><span class="pre">k201</span></code> respectively.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>z1234567@katana1 ~<span class="o">]</span>$ qsub -I
qsub: waiting <span class="k">for</span> job <span class="m">313704</span>.kman.restech.unsw.edu.au to start
qsub: job <span class="m">313704</span>.kman.restech.unsw.edu.au ready
<span class="o">[</span>z1234567@k181 ~<span class="o">]</span>$
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>z1234567@katana2 ~<span class="o">]</span>$ qsub -I -l <span class="k">select</span><span class="o">=</span><span class="m">1</span>:ncpus<span class="o">=</span><span class="m">2</span>:mem<span class="o">=</span>8gb,walltime<span class="o">=</span><span class="m">3</span>:00:00
qsub: waiting <span class="k">for</span> job <span class="m">1234</span>.kman.restech.unsw.edu.au to start
qsub: job <span class="m">1234</span>.kman.restech.unsw.edu.au ready
<span class="o">[</span>z1234567@k201 ~<span class="o">]</span>$
</pre></div>
</div>
<p>Jobs are constrained by the resources that are requested. In the previous example the first job - running on <code class="code docutils literal notranslate"><span class="pre">k181</span></code> - would be terminated after 1 hour or if a command within the session consumed more than 8GB memory. The job (and therefore the session) can also be terminated by the user with <code class="code docutils literal notranslate"><span class="pre">CTRL-D</span></code> or the <code class="code docutils literal notranslate"><span class="pre">logout</span></code> command.</p>
<p>Interactive jobs can be particularly useful while developing and testing code for a future batch job, or performing an interactive analysis that requires significant compute resources. Never attempt such tasks on the login node – submit an interactive job instead.</p>
</div>
<div class="section" id="batch-jobs">
<span id="id1"></span><h2>Batch Jobs<a class="headerlink" href="#batch-jobs" title="Permalink to this headline">¶</a></h2>
<p>A batch job is a script that runs autonomously on a compute node. The script must contain the necessary sequence of commands to complete a task independently of any input from the user. This section contains information about how to create and submit a batch job on Katana.</p>
<div class="section" id="getting-started">
<h3>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h3>
<p>The following script simply executes a pre-compiled program (“myprogram”) in the user’s home directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">cd</span> <span class="nv">$HOME</span>

./myprogram
</pre></div>
</div>
<p>This script can be submitted to the cluster with <code class="code docutils literal notranslate"><span class="pre">qsub</span></code> and it will become a job and be assigned to a queue. If the script is in a file called <code class="code docutils literal notranslate"><span class="pre">myjob.pbs</span></code> then the following command will submit the job with the default resource requirements (1 CPU core with 1GB of memory for 1 hour):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>z1234567@katana1 ~<span class="o">]</span>$ qsub myjob.pbs
<span class="m">1237</span>.kman.restech.unsw.edu.au
</pre></div>
</div>
<p>As with interactive jobs, the <code class="code docutils literal notranslate"><span class="pre">-l</span></code> (lowercase L) flag can be used to specify resource requirements for the job:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>z1234567@katana ~<span class="o">]</span>$ qsub -l <span class="k">select</span><span class="o">=</span><span class="m">1</span>:ncpus<span class="o">=</span><span class="m">1</span>:mem<span class="o">=</span>4gb,walltime<span class="o">=</span><span class="m">12</span>:00:00 myjob.pbs
<span class="m">1238</span>.kman.restech.unsw.edu.au
</pre></div>
</div>
</div>
<div class="section" id="a-job-script">
<h3>A Job Script<a class="headerlink" href="#a-job-script" title="Permalink to this headline">¶</a></h3>
<p>Job scripts offer a much more convenient method for invoking any of the options that can be passed to <code class="code docutils literal notranslate"><span class="pre">qsub</span></code> on the command-line. In a shell script, a line starting with # is a comment and will be ignored by the shell interpreter. However, in a job script, a line starting with #PBS can be used to pass options to the <code class="code docutils literal notranslate"><span class="pre">qsub</span></code> command.</p>
<p>Here is an overview of the different parts of a job script which we will examine further below. In the following sections we will add some code, explain what it does, then show some new code, and iterate up to something quite powerful.</p>
<p>For the previous example, the job script could be rewritten as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#PBS -l select=1:ncpus=1:mem=4gb</span>
<span class="c1">#PBS -l walltime=12:00:00</span>

<span class="nb">cd</span> <span class="nv">$HOME</span>

./myprogram
</pre></div>
</div>
<p>This structure is the most common that you will use. The top line must be <code class="code docutils literal notranslate"><span class="pre">#!/bin/bash</span></code> - we are running bash scripts, and this is required.
The following section - the lines starting with <code class="code docutils literal notranslate"><span class="pre">#PBS</span></code> - are where we will be configuring how the job will be run - here we are asking for resources.
The final section shows the commands that will be executed in the configured session.</p>
<p>The script can now be submitted with much less typing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>z1234567@katana ~<span class="o">]</span>$ qsub myjob.pbs
<span class="m">1239</span>.kman.restech.unsw.edu.au
</pre></div>
</div>
<p>Unlike submission of an interactive job, which results in a session on a compute node ready to accept commands, the submission of a batch job returns the ID of the new job. This is confirmation that the job was submitted successfully. The job is now processed by the job scheduler and resource manager. Commands for checking the status of the job can be found in the section <a class="reference internal" href="#managing-jobs-on-katana"><span class="std std-ref">Managing Jobs on Katana</span></a>.</p>
<p>If you wish to be notified by email when the job finishes then use the <code class="code docutils literal notranslate"><span class="pre">-M</span></code> flag to specify the email address and the <code class="code docutils literal notranslate"><span class="pre">-m</span></code> flag to declare which events cause a notification. Here we will get an email if the job aborts (<code class="code docutils literal notranslate"><span class="pre">-m</span> <span class="pre">a</span></code>) due to an error or ends (<code class="code docutils literal notranslate"><span class="pre">-m</span> <span class="pre">e</span></code>) naturally.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#PBS -M your.name.here@unsw.edu.au</span>
<span class="c1">#PBS -m ae</span>
</pre></div>
</div>
<p>The output that would normally go to screen and error messages of a batch job will be saved to file when your job ends. By default these files will be called <code class="code docutils literal notranslate"><span class="pre">JOB_NAME.oJOB_ID</span></code> and <code class="code docutils literal notranslate"><span class="pre">JOB_NAME.eJOB_ID</span></code>, and they will appear in the directory that was the current working directory when the job was submitted. In the above example, they would be <code class="code docutils literal notranslate"><span class="pre">myjob.o1239</span></code> and <code class="code docutils literal notranslate"><span class="pre">myjob.e1239</span></code>.  You can merge these into a single file with the <code class="code docutils literal notranslate"><span class="pre">-j</span> <span class="pre">oe</span></code> flag. The <code class="code docutils literal notranslate"><span class="pre">-o</span></code> flag allows you to rename the file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#PBS -j oe</span>
<span class="c1">#PBS -o /home/z1234567/results/Output_Report</span>
</pre></div>
</div>
<p>When a job starts, it needs to know where to save it’s output and do it’s work. This is called the <em>current working directory</em>. By default the job scheduler will make your <em>current working directory</em> your home directory (<code class="code docutils literal notranslate"><span class="pre">/home/z1234567</span></code>). This isn’t likely or ideal and is important that each job sets its current working directory appropriately. There are a couple of ways to do this, the easiest is to set the <em>current working directory</em> to the directory you are in when you execute <code class="code docutils literal notranslate"><span class="pre">qsub</span></code> by using</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> <span class="nv">$PBS_O_WORKDIR</span>
</pre></div>
</div>
<p>There is one last special variable you should know about, especially if you are working with large datasets. The storage on the compute node your job is running on will always be faster than the network drive.</p>
<p>If you use the storage close to the CPUs - in the server rather than on the shared drives, called <a class="reference internal" href="../glossary.html#term-Local-Scratch"><span class="xref std std-term">Local Scratch</span></a> - you can often save hours of time reading and writing across the network.</p>
<p>In order to do this, you can copy data to and from the local scratch, called <code class="code docutils literal notranslate"><span class="pre">$TMPDIR</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp /home/z1234567/project/massivedata.tar.gz <span class="nv">$TMPDIR</span>
tar xvf massivedata.tar.gz
my_analysis.py massive_data
cp -r <span class="nv">$TMPDIR</span>/my_output /home/z1234567
</pre></div>
</div>
<p>There are a lot of things that can be done with PBSPro, but you don’t and won’t need to know it all. These few basics will get you started.</p>
<p>Here’s the full script as we’ve described. You can copy this into a text editor and once you’ve changed our dummy values for yours, you only need to change the last line.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#PBS -l select=1:ncpus=1:mem=4gb</span>
<span class="c1">#PBS -l walltime=12:00:00</span>
<span class="c1">#PBS -M your.name.here@unsw.edu.au</span>
<span class="c1">#PBS -m ae</span>
<span class="c1">#PBS -j oe</span>
<span class="c1">#PBS -o /home/z1234567/results/Output_Report</span>

<span class="nb">cd</span> <span class="nv">$PBS_O_WORKDIR</span>

./myprogram
</pre></div>
</div>
</div>
</div>
<div class="section" id="array-jobs">
<span id="id2"></span><h2>Array Jobs<a class="headerlink" href="#array-jobs" title="Permalink to this headline">¶</a></h2>
<p>One common use of computational clusters is to do the same thing multiple times - sometimes with slightly different input, sometimes to get averages from randomness within the process. This is made easier with array jobs.</p>
<p>An array job is a single job script that spawns many almost identical sub-jobs. The only difference between the sub-jobs is an environment variable <code class="code docutils literal notranslate"><span class="pre">$PBS_ARRAY_INDEX</span></code> whose value uniquely identifies an individual sub-job. A regular job becomes an array job when it uses the <code class="code docutils literal notranslate"><span class="pre">#PBS</span> <span class="pre">-J</span></code> flag.</p>
<p>For example, the following script will spawn 100 sub-jobs. Each sub-job will require one CPU core, 1GB memory and 1 hour run-time, and it will execute the same application. However, a different input file will be passed to the application within each sub-job. The first sub-job will read input data from a file called <code class="code docutils literal notranslate"><span class="pre">1.dat</span></code>, the second sub-job will read input data from a file called <code class="code docutils literal notranslate"><span class="pre">2.dat</span></code> and so on.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this example we are using <a class="reference external" href="https://www.gnu.org/software/bash/manual/html_node/Brace-Expansion.html">brace expansion</a> - the {} characters around the bash variables - because they are needed for variables that change, like array indices. They aren’t strictly necessary for <code class="code docutils literal notranslate"><span class="pre">$PBS_O_WORKDIR</span></code> but we include them to show consistency.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#PBS -l select=1:ncpus=1:mem=1gb</span>
<span class="c1">#PBS -l walltime=1:00:00</span>
<span class="c1">#PBS -j oe</span>
<span class="c1">#PBS -J 1-100</span>

<span class="nb">cd</span> <span class="si">${</span><span class="nv">PBS_O_WORKDIR</span><span class="si">}</span>

./myprogram <span class="si">${</span><span class="nv">PBS_ARRAY_INDEX</span><span class="si">}</span>.dat
</pre></div>
</div>
<p>There are some more examples of array jobs including how to group your computations in an array job on the <a class="reference external" href="https://github.com/unsw-edu-au/Restech-HPC/tree/master/hpc-examples">UNSW Github HPC examples</a> page.</p>
</div>
<div class="section" id="splitting-large-batch-jobs">
<h2>Splitting large Batch Jobs<a class="headerlink" href="#splitting-large-batch-jobs" title="Permalink to this headline">¶</a></h2>
<p>If your batch job can be split into multiple steps you may want to split one big job up into a number of smaller jobs. There are a number of reasons to spend the time to implement this.</p>
<ol class="arabic simple">
<li><p>If your large job runs for over 200 hours, it won’t finish on Katana.</p></li>
<li><p>If your job has multiple steps which use different amounts of resources at each step. If you have a pipeline that takes 50 hours to run and needs 200GB of memory for an hour, but only 50GB the rest of the time, then the memory is sitting idle.</p></li>
<li><p>Katana has prioritisations based on how many resources any one user uses. If you ask for 200GB of memory, this will be accounted for when working out your next job’s priority.</p></li>
<li><p>There’s no other way to say this, but because there are more resources for 12 hour jobs, seven or eight 12 hour jobs will often finish well before a single 100 hour job even starts.</p></li>
</ol>
</div>
<div class="section" id="get-information-about-the-state-of-the-scheduler">
<span id="state-of-pbs"></span><h2>Get information about the state of the scheduler<a class="headerlink" href="#get-information-about-the-state-of-the-scheduler" title="Permalink to this headline">¶</a></h2>
<p>When deciding which jobs to run, the scheduler takes the following details into account:</p>
<ul class="simple">
<li><p>are there available resources</p></li>
<li><p>how recently has this user run jobs successfully</p></li>
<li><p>how many resources has this user used recently</p></li>
<li><p>how long is the job’s Walltime</p></li>
<li><p>how long has the job been in the queue</p></li>
</ul>
<p>You can get an overview of the compute nodes and a list of all the jobs running on each node using <code class="code docutils literal notranslate"><span class="pre">pstat</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>z1234567@katana2 src<span class="o">]</span>$ pstat
k001  normal-mrcbio           free          <span class="m">12</span>/44   <span class="m">200</span>/1007gb  <span class="m">314911</span>*12
k002  normal-mrcbio           free          <span class="m">40</span>/44    <span class="m">56</span>/ 377gb  <span class="m">314954</span>*40
k003  normal-mrcbio           free          <span class="m">40</span>/44   <span class="m">375</span>/ 377gb  <span class="m">314081</span>*40
k004  normal-mrcbio           free          <span class="m">40</span>/44    <span class="m">62</span>/ 377gb  <span class="m">314471</span>*40
k005  normal-ccrc             free           <span class="m">0</span>/32     <span class="m">0</span>/ 187gb
k006  normal-physics          job-busy      <span class="m">32</span>/32   <span class="m">180</span>/ 187gb  <span class="m">282533</span>*32
k007  normal-physics          job-busy      <span class="m">32</span>/32   <span class="m">180</span>/ 187gb  <span class="m">284666</span>*32
k008  normal-physics          free           <span class="m">0</span>/32     <span class="m">0</span>/ 187gb
k009  normal-physics          job-busy      <span class="m">32</span>/32   <span class="m">124</span>/ 187gb  <span class="m">314652</span>*32
k010  normal-physics          free           <span class="m">0</span>/32     <span class="m">0</span>/ 187gb
</pre></div>
</div>
<p>To get information about a particular node, you can use <code class="code docutils literal notranslate"><span class="pre">pbsnodes</span></code> but on it’s own it is a firehose. Using it with a particular node name is more effective:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>z1234567@katana2 src<span class="o">]</span>$ pbsnodes k254
k254
     <span class="nv">Mom</span> <span class="o">=</span> k254
     <span class="nv">ntype</span> <span class="o">=</span> PBS
     <span class="nv">state</span> <span class="o">=</span> job-busy
     <span class="nv">pcpus</span> <span class="o">=</span> <span class="m">32</span>
     <span class="nb">jobs</span> <span class="o">=</span> <span class="m">313284</span>.kman.restech.unsw.edu.au/0, <span class="m">313284</span>.kman.restech.unsw.edu.au/1, <span class="m">313284</span>.kman.restech.unsw.edu.au/2
     resources_available.arch <span class="o">=</span> linux
     resources_available.cpuflags <span class="o">=</span> avx,avx2,avx512bw,avx512cd,avx512dq,avx512f,avx512vl
     resources_available.cputype <span class="o">=</span> skylake-avx512
     resources_available.host <span class="o">=</span> k254
     resources_available.mem <span class="o">=</span> 196396032kb
     resources_available.ncpus <span class="o">=</span> <span class="m">32</span>
     resources_available.node_weight <span class="o">=</span> <span class="m">1</span>
     resources_available.normal-all <span class="o">=</span> Yes
     resources_available.normal-qmchda <span class="o">=</span> Yes
     resources_available.normal-qmchda-maths_business-maths <span class="o">=</span> Yes
     resources_available.normal-qmchda-maths_business-maths-general <span class="o">=</span> Yes
     resources_available.vmem <span class="o">=</span> 198426624kb
     resources_available.vnode <span class="o">=</span> k254
     resources_available.vntype <span class="o">=</span> compute
     resources_assigned.accelerator_memory <span class="o">=</span> 0kb
     resources_assigned.hbmem <span class="o">=</span> 0kb
     resources_assigned.mem <span class="o">=</span> 50331648kb
     resources_assigned.naccelerators <span class="o">=</span> <span class="m">0</span>
     resources_assigned.ncpus <span class="o">=</span> <span class="m">32</span>
     resources_assigned.ngpus <span class="o">=</span> <span class="m">0</span>
     resources_assigned.vmem <span class="o">=</span> 0kb
     <span class="nv">resv_enable</span> <span class="o">=</span> True
     <span class="nv">sharing</span> <span class="o">=</span> default_shared
     <span class="nv">last_state_change_time</span> <span class="o">=</span> Thu Apr <span class="m">30</span> <span class="m">08</span>:06:23 <span class="m">2020</span>
     <span class="nv">last_used_time</span> <span class="o">=</span> Thu Apr <span class="m">30</span> <span class="m">07</span>:08:25 <span class="m">2020</span>
</pre></div>
</div>
</div>
<div class="section" id="managing-jobs-on-katana">
<span id="managing-jobs"></span><h2>Managing Jobs on Katana<a class="headerlink" href="#managing-jobs-on-katana" title="Permalink to this headline">¶</a></h2>
<p>Once you have jobs running, you will want visibility of the system so that you can manage them - delete jobs, change jobs, check that jobs are still running.</p>
<p>There are a couple of easy to use commands that help with this process.</p>
<div class="section" id="qstat">
<h3>qstat<a class="headerlink" href="#qstat" title="Permalink to this headline">¶</a></h3>
<div class="section" id="show-all-jobs-on-the-system">
<span id="more-info-from-pbs"></span><h4>Show all jobs on the system<a class="headerlink" href="#show-all-jobs-on-the-system" title="Permalink to this headline">¶</a></h4>
<p><code class="code docutils literal notranslate"><span class="pre">qstat</span></code> gives very long output. Consider piping to <code class="code docutils literal notranslate"><span class="pre">less</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>z1234567@katana2 ~<span class="o">]</span>$ qstat <span class="p">|</span> less
Job id            Name             User              Time Use S Queue
----------------  ---------------- ----------------  -------- - -----
<span class="m">245821</span>.kman       s-m20-i20-200h   z1234567                 <span class="m">0</span> Q medicine200
<span class="m">280163</span>.kman       Magcomp25A2      z1234567          <span class="m">3876</span>:18: R mech700
<span class="m">282533</span>.kman       Proj_MF_Nu1      z1234567          <span class="m">3280</span>:08: R cosmo200
<span class="m">284666</span>.kman       Proj_BR_Nu1      z1234567          <span class="m">3279</span>:27: R cosmo200
<span class="m">308559</span>.kman       JASASec55        z1234567          <span class="m">191</span>:21:3 R maths200
<span class="m">309615</span>.kman       <span class="m">2020</span>-04-06.BUSC  z1234567          <span class="m">185</span>:00:5 R babs200
<span class="m">310623</span>.kman       Miaocyclegan     z1234567          <span class="m">188</span>:06:3 R simigpu200
...
</pre></div>
</div>
</div>
<div class="section" id="list-just-my-jobs">
<h4>List just my jobs<a class="headerlink" href="#list-just-my-jobs" title="Permalink to this headline">¶</a></h4>
<p>You can use either your <strong>ZID</strong> or the <a class="reference internal" href="../glossary.html#term-Environment-Variable"><span class="xref std std-term">Environment Variable</span></a> <code class="code docutils literal notranslate"><span class="pre">$USER</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>z2134567@katana2 src<span class="o">]</span>$ qstat -u <span class="nv">$USER</span>
kman.restech.unsw.edu.au:
                                                            Req<span class="s1">&#39;d  Req&#39;</span>d   Elap
Job ID          Username Queue    Jobname    SessID NDS TSK Memory Time  S Time
--------------- -------- -------- ---------- ------ --- --- ------ ----- - -----
<span class="m">315230</span>.kman.res z2134567 general1 job.pbs       --    <span class="m">1</span>   <span class="m">1</span>    1gb <span class="m">01</span>:00 Q   --
</pre></div>
</div>
<p>If you add the <code class="code docutils literal notranslate"><span class="pre">-s</span></code> flag, you will get slightly more status information.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>z1234567@katana2 src<span class="o">]</span>$ qstat -su z1234567

kman.restech.unsw.edu.au:
                                                            Req<span class="s1">&#39;d  Req&#39;</span>d   Elap
Job ID          Username Queue    Jobname    SessID NDS TSK Memory Time  S Time
--------------- -------- -------- ---------- ------ --- --- ------ ----- - -----
<span class="m">315230</span>.kman.res z1234567 general1 job.pbs     <span class="m">61915</span>   <span class="m">1</span>   <span class="m">1</span>    1gb <span class="m">01</span>:00 R <span class="m">00</span>:03
   Job run at Fri May <span class="m">01</span> at <span class="m">14</span>:28 on <span class="o">(</span>k019:mem<span class="o">=</span>1048576kb:ncpus<span class="o">=</span><span class="m">1</span>:ngpus<span class="o">=</span><span class="m">0</span><span class="o">)</span>
<span class="m">315233</span>.kman.res z1234567 general1 job.pbs       --    <span class="m">1</span>   <span class="m">1</span>    1gb <span class="m">01</span>:00 Q   --
    --
</pre></div>
</div>
</div>
<div class="section" id="list-information-about-a-particular-job">
<h4>List information about a particular job<a class="headerlink" href="#list-information-about-a-particular-job" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>z1234567@katana2 src<span class="o">]</span>$ qstat -f <span class="m">315236</span>
Job Id: <span class="m">315236</span>.kman.restech.unsw.edu.au
    <span class="nv">Job_Name</span> <span class="o">=</span> job.pbs
    <span class="nv">Job_Owner</span> <span class="o">=</span> z1234567@katana2
    <span class="nv">job_state</span> <span class="o">=</span> Q
    <span class="nv">queue</span> <span class="o">=</span> general12
    <span class="nv">server</span> <span class="o">=</span> kman.gen
    <span class="nv">Checkpoint</span> <span class="o">=</span> u
    <span class="nv">ctime</span> <span class="o">=</span> Fri May  <span class="m">1</span> <span class="m">14</span>:41:00 <span class="m">2020</span>
    <span class="nv">Error_Path</span> <span class="o">=</span> katana2:/home/z1234567/src/job.pbs.e315236
    <span class="nv">group_list</span> <span class="o">=</span> GENERAL
    <span class="nv">Hold_Types</span> <span class="o">=</span> n
    <span class="nv">Join_Path</span> <span class="o">=</span> n
    <span class="nv">Keep_Files</span> <span class="o">=</span> n
    <span class="nv">Mail_Points</span> <span class="o">=</span> a
    <span class="nv">mtime</span> <span class="o">=</span> Fri May  <span class="m">1</span> <span class="m">14</span>:41:00 <span class="m">2020</span>
    <span class="nv">Output_Path</span> <span class="o">=</span> katana2:/home/z1234567/src/job.pbs.o315236
    <span class="nv">Priority</span> <span class="o">=</span> <span class="m">0</span>
    <span class="nv">qtime</span> <span class="o">=</span> Fri May  <span class="m">1</span> <span class="m">14</span>:41:00 <span class="m">2020</span>
    <span class="nv">Rerunable</span> <span class="o">=</span> True
    Resource_List.ib <span class="o">=</span> no
    Resource_List.mem <span class="o">=</span> 1gb
    Resource_List.ncpus <span class="o">=</span> <span class="m">1</span>
    Resource_List.ngpus <span class="o">=</span> <span class="m">0</span>
    Resource_List.nodect <span class="o">=</span> <span class="m">1</span>
    Resource_List.place <span class="o">=</span> pack
    Resource_List.select <span class="o">=</span> <span class="m">1</span>:mem<span class="o">=</span>1gb:ncpus<span class="o">=</span><span class="m">1</span>
    Resource_List.walltime <span class="o">=</span> <span class="m">01</span>:00:00
    <span class="nv">substate</span> <span class="o">=</span> <span class="m">10</span>
    <span class="nv">Variable_List</span> <span class="o">=</span> <span class="nv">PBS_O_HOME</span><span class="o">=</span>/home/z1234567,PBS_O_LANG<span class="o">=</span>en_AU.UTF-8,
        <span class="nv">PBS_O_LOGNAME</span><span class="o">=</span>z1234567,
        <span class="nv">PBS_O_PATH</span><span class="o">=</span>/home/z1234567/bin:/usr/lib64/qt-3.3/bin:/usr/lib64/ccache:
        /usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/opt/pbs/bin,PBS_O_M
        <span class="nv">AIL</span><span class="o">=</span>/var/spool/mail/z1234567,PBS_O_SHELL<span class="o">=</span>/bin/bash,PBS_O_WORKDIR<span class="o">=</span>/home
        /z1234567/src,PBS_O_SYSTEM<span class="o">=</span>Linux,PBS_O_QUEUE<span class="o">=</span>submission,PBS_O_HOST<span class="o">=</span>kat
        ana2
    <span class="nv">etime</span> <span class="o">=</span> Fri May  <span class="m">1</span> <span class="m">14</span>:41:00 <span class="m">2020</span>
    <span class="nv">eligible_time</span> <span class="o">=</span> <span class="m">00</span>:00:00
    <span class="nv">Submit_arguments</span> <span class="o">=</span> -W <span class="nv">group_list</span><span class="o">=</span>GENERAL -N job.pbs job.pbs.JAZDNgL
    <span class="nv">project</span> <span class="o">=</span> _pbs_project_default
</pre></div>
</div>
</div>
</div>
<div class="section" id="qdel">
<h3>qdel<a class="headerlink" href="#qdel" title="Permalink to this headline">¶</a></h3>
<p>Remove a job from the queue or kill it if it’s started. To remove an array job, you must include the square braces and they will need to be escaped. In that situation you use <code class="code docutils literal notranslate"><span class="pre">qdel</span> <span class="pre">12345\[\]</span></code>. Uses the <code class="code docutils literal notranslate"><span class="pre">$JOBID</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>z1234567@katana2 src<span class="o">]</span>$ qdel <span class="m">315252</span>
</pre></div>
</div>
</div>
<div class="section" id="qalter">
<h3>qalter<a class="headerlink" href="#qalter" title="Permalink to this headline">¶</a></h3>
<p>Once a job has been submitted, it can be altered. However, once a job begins execution, the only values that can be modified are <code class="code docutils literal notranslate"><span class="pre">cputime</span></code>, <code class="code docutils literal notranslate"><span class="pre">walltime</span></code>, and <code class="code docutils literal notranslate"><span class="pre">run_count</span></code>. These can only be reduced.</p>
<p>Users can only lower resource requests on queued jobs. If you need to increase resources, contact a systems administrator. In this example you will see the resources change - but not the <code class="code docutils literal notranslate"><span class="pre">Submit_arguments</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>z1234567@katana2 src<span class="o">]</span>$ qsub -l <span class="k">select</span><span class="o">=</span><span class="m">1</span>:ncpus<span class="o">=</span><span class="m">2</span>:mem<span class="o">=</span>128mb job.pbs
<span class="m">315259</span>.kman.restech.unsw.edu.au
<span class="o">[</span>z1234567@katana2 src<span class="o">]</span>$ qstat -f <span class="m">315259</span>
Job Id: <span class="m">315259</span>.kman.restech.unsw.edu.au
    ...
    Resource_List.mem <span class="o">=</span> 128mb
    Resource_List.ncpus <span class="o">=</span> <span class="m">2</span>
    ...
    <span class="nv">Submit_arguments</span> <span class="o">=</span> -W <span class="nv">group_list</span><span class="o">=</span>GENERAL -N job.pbs -l <span class="k">select</span><span class="o">=</span><span class="m">1</span>:ncpus<span class="o">=</span><span class="m">2</span>:mem<span class="o">=</span>128mb job.pbs.YOOu3lB
    <span class="nv">project</span> <span class="o">=</span> _pbs_project_default

<span class="o">[</span>z1234567@katana2 src<span class="o">]</span>$ qalter -l <span class="k">select</span><span class="o">=</span><span class="m">1</span>:ncpus<span class="o">=</span><span class="m">4</span>:mem<span class="o">=</span>512mb <span class="m">315259</span><span class="p">;</span> qstat -f <span class="m">315259</span>
Job Id: <span class="m">315259</span>.kman.restech.unsw.edu.au
    ...
    Resource_List.mem <span class="o">=</span> 512mb
    Resource_List.ncpus <span class="o">=</span> <span class="m">4</span>
    ...
    <span class="nv">Submit_arguments</span> <span class="o">=</span> -W <span class="nv">group_list</span><span class="o">=</span>GENERAL -N job.pbs -l <span class="k">select</span><span class="o">=</span><span class="m">1</span>:ncpus<span class="o">=</span><span class="m">2</span>:mem<span class="o">=</span>128mb job.pbs.YOOu3lB
    <span class="nv">project</span> <span class="o">=</span> _pbs_project_default
</pre></div>
</div>
</div>
</div>
<div class="section" id="tips-for-using-pbs-and-katana-effectively">
<span id="scheduler-tips"></span><h2>Tips for using PBS and Katana effectively<a class="headerlink" href="#tips-for-using-pbs-and-katana-effectively" title="Permalink to this headline">¶</a></h2>
<div class="section" id="keep-your-jobs-under-12-hours-if-possible">
<h3>Keep your jobs under 12 hours if possible<a class="headerlink" href="#keep-your-jobs-under-12-hours-if-possible" title="Permalink to this headline">¶</a></h3>
<p>If you request more than 12 hours of <code class="code docutils literal notranslate"><span class="pre">WALLTIME</span></code> then you can only use the nodes bought by your school or research group. Keeping your job’s run time request under 12 hours means that it can run on any node in the cluster.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Two 10 hour jobs will probably finish sooner that one 20 hour job.</p>
</div>
<p>In fact, if there is spare capacity on Katana, which there is most of the time, six 10 hours jobs will finish before a single 20 hour job will.
Requesting more resources for your job decreases the places that the job can run</p>
<p>The most obvious example is going over the 12 hour limit which limits the number of compute nodes that your job can run on but it is worth . For example specifying the CPU in your job script restricts you to the nodes with that CPU. A job that requests 20Gb will run on a 128Gb node with a 100Gb job already running but a 30Gb job will not be able to.</p>
</div>
<div class="section" id="running-your-jobs-interactively-makes-it-hard-to-manage-multiple-concurrent-jobs">
<h3>Running your jobs interactively makes it hard to manage multiple concurrent jobs<a class="headerlink" href="#running-your-jobs-interactively-makes-it-hard-to-manage-multiple-concurrent-jobs" title="Permalink to this headline">¶</a></h3>
<p>If you are currently only running jobs interactively then you should move to batch jobs which allow you to submit more jobs which then start, run and finish automatically.
If you have multiple batch jobs that are almost identical then you should consider using array jobs</p>
<p>If your batch jobs are the same except for a change in file name or another variable then you should have a look at using array jobs.</p>
</div>
</div>
</div>


	    </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="github.html" class="btn btn-neutral float-right" title="GitHub">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="accessing_katana.html" class="btn btn-neutral" title="Accessing Katana"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Lachlan Simpson.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/jucacrispim/sphinx_pdj_theme">theme</a> provided by <a href="http://poraodojuca.net">Porão do Juca</a>.

</footer>
	</div>
	</div>
	  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.9',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
    <script type="text/javascript" src="../_static/jquery.js">

    </script>
    <script type="text/javascript" src="../_static/underscore.js">

    </script>
    <script type="text/javascript" src="../_static/doctools.js">

    </script>
    <script type="text/javascript" src="../_static/language_data.js">

    </script>

  

   <script type="text/javascript"
           src="../_static/js/theme.js"></script>

   <script type="text/javascript"
           src="../_static/js/pdj.js"></script>

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

  </body>
</html>